Evolution operator can be written as:
$$
\hat U(t_1,t_1)=\left\{
\begin{split}
T\{e^{-i\int_{t_1}^{t_2}dt\hat H(t)}\},&~~~t_2>t_1 \\
\bar T\{e^{+i\int_{t_2}^{t_1}dt\hat H(t)}\},&~~~t_2<t_1
\end{split}
\right.
$$
Heisenberg picture operator is defined as:
$$
\hat O_H(T)=\hat U(t_0,t)\hat O(t)\hat U(t,t_0),
$$
where $\bar O(t)$ has eigenvalues that change in time.
Equations of motion for fields operator read:
$$
\begin{split}
i\frac{d}{dt}\hat\psi_H({\bf x},t)=
\sum_{\sigma'}h_{\sigma\sigma'}({\bf r}, -i{\bf\nabla},{\bf S},t)
\hat\psi_H({\bf r}\sigma,t)+
\int d{\bf x}'v({\bf x},{\bf x'})\hat n_H({\bf x},t)\hat\psi_H({\bf x},t), 
\\
i\frac{d}{dt}\hat\psi^\dagger_H({\bf x},t)=
-\sum_{\sigma'}\hat\psi^\dagger_H({\bf r}\sigma,t)
h_{\sigma\sigma'}({\bf r}, i\overleftarrow {\bf\nabla},{\bf S},t)-
\int d{\bf x}'v({\bf x},{\bf x'})\hat\psi^\dagger_H({\bf x},t)\hat n_H({\bf x},t).
\end{split}
$$
They are invariant under the following gauge transformations:
$$
\begin{split}
{\bf A}({\bf r, t}) & \rightarrow{\bf A}({\bf r, t})+
{\bf \nabla}\Lambda({\bf r, t}) \\
V({\bf r, t}) & \rightarrow V({\bf r, t})-
\frac{1}{c}\frac{\partial}{\partial t}\Lambda({\bf r, t}) \\
\hat\psi_H)({\bf x, t} & \rightarrow\hat\psi_H({\bf x, t})
\exp\left[i\frac{q}{c}\Lambda({\bf x, t})\right]
\end{split}
$$
Continuity equation takes the form:
$$
\frac{d}{dt}\hat n_H({\bf x},t)=-{\bf\nabla}\cdot\left[
\hat{\bf j}_H({\bf x},t)+\hat{\bf j}_{d,H}({\bf x},t)
\right],
$$
where the paramagnetic current density operator:
$$
\hat{\bf j}({\bf x})=
\frac{1}{2mi}\left[
\hat\psi^\dagger({\bf x})\left({\bf\nabla}\hat\psi({\bf x})\right)-
\left({\bf\nabla}\hat\psi^\dagger({\bf x})\right)\hat\psi({\bf x})
\right].
$$
and the diamagnetic current density operator:
$$
\hat{\bf j}_d({\bf x},t)=-\frac{q}{mc}\hat n({\bf x}){\bf A}({\bf r},t).
$$
The current density operator:
$$
\hat{\bf J}({\bf x},t)=\hat{\bf j}({\bf x})+\hat{\bf j}_d({\bf x},t)
$$
is gauge-invariant and this observable.
## The contour
Since the field operators carry no dependence on time:
$$
\hat\psi({\bf x},z=t_\pm)=\hat\psi({\bf x}),~~~
\hat\psi^\dagger({\bf x},z=t_\pm)=\hat\psi^\dagger({\bf x}).
$$
Ensemble average of an operator at a given time (in a mixed states, that is, in contact with an environment):
$$
\begin{split}
O(t_0) &=
\sum_nw_n\langle\chi_n|\hat O(t_0)|\chi_n\rangle=
\sum_k\sum_nw_n\langle\chi_n|\Psi_k\rangle\langle\Psi_k|\hat O(t_0)|\chi_n\rangle\\
&=\sum_k\langle\Psi_k|\hat O(t_0)|\Psi_k\rangle=
\mathrm{Tr}\left[\hat O(t_0)\hat\rho\right]=
\mathrm{Tr}\left[\hat\rho\hat O(t_0)\right],
\end{split}
$$
where $|\Psi_k\rangle$ is an arbitrary basis of orthonormal states. This implies that $\mathrm{Tr}[\hat\rho]=1$ and $\mathrm{Tr}[\hat\rho^2]=1$. The most general expression for the eigenvalues that fulfill these constraints is:
$$
\rho_k=\frac{e^{-x_k}}{\sum_pe^{-x_p}}.
$$
We write $x_k=\beta E^M_k$ and construct the operator
$$
\hat H^M=\sum_kE^M_k|\Psi_k\rangle\langle\Psi_k|.
$$
Thus, the density operator can be written as:
$$
\hat\rho=\sum_k\frac{e^{-\beta E^M_k}}{Z}|\Psi_k\rangle\langle\Psi_k|=
\frac{e^{-\beta\hat H^M}}{Z},
$$
where the partition function:
$$
Z=\sum_ke^{-\beta E^M_k}=\mathrm{Tr}\left[e^{-\beta\hat H^M}\right].
$$
The general average of an operator can be expressed using contour integral:
$$
O(z)=\frac{
\mathrm{Tr}\left[
{\cal T}\left\{
e^{-i\int_\gamma dz\hat H(z)}\hat O(z)
\right\}
\right]
}{\mathrm{Tr}\left[
{\cal T}\left\{
e^{-i\int_\gamma dz\hat H(z)}
\right\}
\right]
},
$$
where $\gamma$ is a general contour in the complex time plane.
It is easy to verify that
$$
\hat U(t_2,t_1)=\hat U(t_{2-},t_{1-})=\hat U(t_{2+},T_{1+}).
$$
And one introduces a contour Heisenberg picture
$$
\hat O_H(z)=\hat U(z_i,z)\hat O(z)\hat U(z,z_i).
$$
Field operators with arguments on $\gamma^M$ are *defined* as
$$
\bar\psi({\bf x}z\in\gamma^M)\equiv\hat\psi({\bf x}),~~~
\bar\psi^\dagger({\bf x}z\in\gamma^M)\equiv\hat\psi^\dagger({\bf x}),
$$
so in total, fields operators are constant over the entire contour. One can derive the equations of motion
$$
\begin{split}
i\frac{d}{dz}\hat\psi_H({\bf x},z)=
\int d{\bf x}'\langle{\bf x}|\hat h(z)|{\bf x}'\rangle\hat\psi_H({\bf x}',z)+
\int d{\bf x}'v({\bf x},{\bf x}',z)\hat n_H({\bf x}',z)\hat\psi_H({\bf x},z),\\

-i\frac{d}{dz}\hat\psi^\dagger_H({\bf x},z)=
\int d{\bf x}'\hat\psi^\dagger_H({\bf x}',z)\langle{\bf x}'|\hat h(z)|{\bf x}\rangle+
\int d{\bf x}'v({\bf x},{\bf x}',z)\hat\psi^\dagger_H({\bf x},z)\hat n_H({\bf x}',z),\\
\end{split}
$$
where the matrix element:
$$
\langle{\bf x}|\hat h(z)|{\bf x}'\rangle=
h_{\sigma\sigma'}({\bf r},-i{\bf\nabla},{\bf S},z)\delta({\bf r}-{\bf r}')=
\delta({\bf r}-{\bf r}')h_{\sigma\sigma'}({\bf r}',i\overleftarrow{\bf\nabla}',{\bf S},z).

$$
For the correlators of field operators:
$$
\hat G_n(1,...,n;1',...n')\equiv\frac{1}{i^n}{\cal T}\left\{
\hat\psi_H({\bf x}_1)...\hat\psi_H({\bf x}_n)
\hat\psi^\dagger_H({\bf x}'_n)...\hat\psi^\dagger_H({\bf x}'_1)
\right\}.
$$
the Martin-Schwinger hierarchy equations of motion are:
$$
\begin{split}

\left[
i\frac{d}{dz_k}-h(k)
\right]
\hat G_n(1,...,n;1',...n')&=\pm i\int d\bar 1v(k;\bar1)
\hat G_{n+1}(1,...,n;\bar 1,1',...n',\bar 1^+)\\&
+\sum_{j=1}^n(\pm)^{k+j}\delta(k,j')\hat G_{n-1}(1,...,{\check k},...,n;1',...,\check j',...n'),\\


\hat G_n(1,...,n;1',...n')
\left[
-i\frac{\overleftarrow d}{dz'_k}-h(k')
\right]
&=\pm i\int d\bar 1v(k';\bar1)
\hat G_{n+1}(1,...,n;\bar 1^-,1',...n',\bar 1)\\&
+\sum_{j=1}^n(\pm)^{k+j}\delta(j;k')\hat G_{n-1}(1,...,{\check j},...,n;1',...,\check k',...n'),


\end{split},
$$
where one assumed that $\hat h$ is diagonal and 
$$
\langle{\bf x}_1|\hat h(z_1)|{\bf x_2}\rangle=
h(1)\delta({\bf x}_1-{\bf x}_2)=\delta({\bf x}_1-{\bf x}_2)h(2).
$$
The Green's function follow the Kubo-Martin-Schwinger relations:
$$
\begin{split}
G_n(1,...,{\bf x}_k,z_i,...,n;1',...,n')=
\pm G_n(1,...,{\bf x}_k,z_f,...,n;1',...,n'),\\
G_n(1,...n;1',...,{\bf x}'_k,z_i,...,,n')=
\pm G_n(1,...,n;1',...,{\bf x}'_k,z_f,...,n').
\end{split}
$$
In the non-interacting case $v=0$, only higher-order Green's functions are coupled to the lower-order ones. In that case, the hierarchy equations can be solved using the Wick theorem:
$$
G_{0,n}(1,...,n;1',...,n')=
\left|
\begin{matrix}
G_0(1;1') & ...  & G_0(1;n')\\
\vdots    &      & \vdots   \\
G_0(n;1') & ...  & G_0(n;n')
\end{matrix}
\right|_\pm.
$$
In a more general case, for interacting one-particle Green's function,
$$
G(a;b)=\frac{
\sum_{k=0}^\infty\frac{1}{k!}\left(\frac{1}{2}\right)^k
\int v(1;1')...v(k;k')\left|
\begin{matrix}
G_0(a;b)  & G_0(a;1^+)  & ... & G_0(a;k^+)  \\
G_0(1;b)  & G_0(1;1^+)  & ... & G_0(1;k^+)  \\
\vdots    & \vdots      &     & \vdots      \\
G_0(k';b) & G_0(k';1^+) & ... & G_0(k';k'^+) \\
\end{matrix}
\right|_\pm
}{
\sum_{k=0}^\infty\frac{1}{k!}\left(\frac{1}{2}\right)^k
\int v(1;1')...v(k;k')\left|
\begin{matrix}
G_0(1;1^+)  & G_0(1;1'^+)  & ... & G_0(1;k'^+)  \\
G_0(1';1+)  & G_0(1';1'^+)  & ... & G_0(1';k'^+)  \\
\vdots    & \vdots      &     & \vdots      \\
G_0(k';1^+) & G_0(k';1'^+) & ... & G_0(k';k'^+) \\
\end{matrix}
\right|_\pm
}.
$$
For two-particle,
$$
G_2(a,b;c,d)=\frac{
\sum_{k=0}^\infty\frac{1}{k!}\left(\frac{1}{2}\right)^k
\int v(1;1')...v(k;k')\left|
\begin{matrix}
G_0(a;c)  & G_0(a;d)  & ... & G_0(a;k^+)  \\
G_0(b;c)  & G_0(b;d)  & ... & G_0(b;k^+)  \\
\vdots    & \vdots      &     & \vdots      \\
G_0(k';c) & G_0(k';d) & ... & G_0(k';k'^+) \\
\end{matrix}
\right|_\pm
}{
\sum_{k=0}^\infty\frac{1}{k!}\left(\frac{1}{2}\right)^k
\int v(1;1')...v(k;k')\left|
\begin{matrix}
G_0(1;1^+)  & G_0(1;1'^+)  & ... & G_0(1;k'^+)  \\
G_0(1';1+)  & G_0(1';1'^+)  & ... & G_0(1';k'^+)  \\
\vdots    & \vdots      &     & \vdots      \\
G_0(k';1^+) & G_0(k';1'^+) & ... & G_0(k';k'^+) \\
\end{matrix}
\right|_\pm
}.
$$For partition function:
$$
\frac{Z}{Z_0}=\sum_{k=0}^\infty\frac{1}{k!}\left(\frac{1}{2}\right)^k
\int v(1;1')...v(k;k')\left|
\begin{matrix}
G_0(1;1^+)  & G_0(1;1'^+)  & ... & G_0(1;k'^+)  \\
G_0(1';1+)  & G_0(1';1'^+)  & ... & G_0(1';k'^+)  \\
\vdots    & \vdots      &     & \vdots      \\
G_0(k';1^+) & G_0(k';1'^+) & ... & G_0(k';k'^+) \\
\end{matrix}
\right|_\pm.
$$
In the case of a two-point correlator:
$$
k(z,z')=
\mathrm{Tr}\left[\hat\rho\hat k(z,z')\right]=
\mathrm{Tr}\left[\hat\rho\hat {\cal T}\left\{
\hat O_1(z)\hat O_2(z')).
\right\}\right]\equiv\theta(z,z')k^>(z,z')+\theta(z',z)k^<(z,z').
$$
Then one has
$$
k^\lessgtr(t_+,z')=k^\lessgtr(t_-,z'),~~~k^\lessgtr(z,t'_+)=k^\lessgtr(z,t'_-).
$$
One defines:
$$
\begin{split}
k^>(t,t')\equiv k(t_+,t'_-),&~~~k^<(t,t')\equiv k(t_-,t'_+),\\
k^\ulcorner(\tau,t)\equiv k(t_0-i\tau,t_\pm),&~~~k^\urcorner(t,\tau)\equiv k(t_\pm,t_0-i\tau).\\
k^M(\tau,\tau')\equiv k(t_0-i\tau,t_0-i\tau')&=\delta(t_0-i\tau,t_0-i\tau')k^\delta(t_0-i\tau)+k^M_r(\tau,\tau'),
\end{split}
$$
where
$$
k^M_r(\tau,\tau')=\theta(\tau-\tau')k^>(t_0-i\tau,t_0-i\tau')+
\theta(\tau'-\tau)k^<(t_0-i\tau,t_0-i\tau').
$$
Retarded and advanced functions:
$$
\begin{split}
k^R(t,t')=k^\delta(t)\delta(t-t')+\theta(t-t')[k^>(t,t')-k^<(t,t')],\\
k^A(t,t')=k^\delta(t)\delta(t-t')-\theta(t'-t)[k^>(t,t')-k^<(t,t')].
\end{split}
$$
Two convoutions:
$$
\begin{split}
f\cdot g\equiv\int_{t_0}^\infty d\bar tf(\bar t)g(\bar t),~~~
f*g=-i\int_0^\beta d\bar\tau f(\bar\tau)g(\bar\tau).
\end{split}
$$
Then if we define:
$$
c(z,z')=\int_\gamma d\bar za(z,\bar z)b\bar z,z'),
$$
one gets:
$$
\begin{split}
c^>&=a^>\cdot b^A+a^R\cdot b^>+a^\urcorner*b\ulcorner,\\
c^<&=a^<\cdot b^A+a^R\cdot b^<+a^\urcorner*b\ulcorner.\\
c^\urcorner&=a^R\cdot b^\urcorner+a^\urcorner* b^M,\\
c^\ulcorner&=a^\ulcorner\cdot b^A+a^M*b^\ulcorner,\\
c^M&=a^M*b^M.
\end{split}
$$
Time-ordered and anti-time-ordered components:
$$
\begin{split}
k^T(t,t')\equiv k(t_-,t_-')=k^\delta(t)\delta(t-t')+
\theta(t-t')k^>(t,t')+\theta(t'-t)k^<(t,t'),\\
k^{\bar T}(t,t')\equiv k(t_+,t_+')=-k^\delta(t)\delta(t-t')+
\theta(t'-t)k^>(t,t')+\theta(t-t')k^<(t,t').
\end{split}
$$